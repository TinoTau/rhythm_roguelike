# 🎼 Rhythm Roguelike 联机模式战斗流程设计文档（2 / 3 / 4 人合作）

> 本文档定义 **Rhythm Roguelike** 的联机（Co-op）战斗完整流程，
> 重点解决以下问题：
>
> - 如何在 **2 / 3 / 4 人** 不同人数下保持玩法一致性
> - 如何让 **高手承担更多结构责任，新手不拖后腿**
> - 如何通过“音轨分工 + 结构权限”实现真正的乐团体验
> - 一场战斗如何在 **3–5 分钟** 内完成，并产生高光收束

本文档为 **可实现级系统设计**，可直接作为 GDD 的 Multiplayer / Co-op Combat 章节。

---

## 1. 联机模式的核心设计原则

### 1.1 核心目标

> **联机不是让每个人玩完整系统，
> 而是让每个人在结构中承担不同责任。**

联机模式的目标：
- 新手：
  - 只需把“自己负责的部分”做好
  - 不会因失误毁掉整首曲子
- 高手：
  - 通过承担更多音轨或结构权限
  - 决定是否进入高光收束

---

### 1.2 核心手段

- 音轨分工（谁管哪条轨）
- 结构权限（谁能决定“收 / 不收”）
- 能力介入（高手可以接管风险）

---

## 2. 音轨分配规则（2 / 3 / 4 人统一模型）

### 2.1 四音轨固定定义（冻结）

| 音轨 | 职责 | 战斗含义 |
|---|---|---|
| Track A | 进攻主轨 | 主伤害 / 武器充能 |
| Track B | 进攻副轨 | 爆发 / 特效 |
| Track C | 防御主轨 | 护盾 / 减伤 |
| Track D | 防御副轨 | 格挡 / 回复 |

---

### 2.2 不同人数下的音轨管理方式

#### 4 人模式（标准乐团）

- 每名玩家管理 **1 条音轨**
- 责任最清晰，最适合公开匹配

| 玩家 | 音轨 |
|---|---|
| P1 | Track A |
| P2 | Track B |
| P3 | Track C |
| P4 | Track D |

---

#### 3 人模式（半指挥制）

- 1 名高手玩家管理 **2 条音轨**
- 其余玩家各管 1 条

示例：

| 玩家 | 音轨 |
|---|---|
| P1（高手） | Track A + B |
| P2 | Track C |
| P3 | Track D |

---

#### 2 人模式（双人制作人）

- 每名玩家管理 **2 条音轨**
- 强调协作与结构判断

| 玩家 | 音轨 |
|---|---|
| P1 | Track A + C |
| P2 | Track B + D |

---

## 3. 联机战斗的整体流程（每一回合）

### 3.1 回合开始：怪物行动公开

- 怪物公布本回合行动模式：
  - 全进攻 / 全防御 / 混合
- 系统据此：
  - 标记哪些音轨被 **固定**
  - 哪些音轨需要玩家编排

---

### 3.2 回合编排阶段（核心交互）

对每一条 **可编排音轨**：

1. 系统生成该音轨的 **4 选 1 候选池**
2. 负责该音轨的玩家进行选择

> 若玩家负责 2 条音轨，则需分别完成两次选择。

---

### 3.3 能力介入阶段（高手表达空间）

- 任意玩家可在此阶段使用能力：
  - 兜底失败
  - 转移得分
  - 覆盖固定规则
  - 标记“准备收束”

能力的使用顺序可配置为：
- 同时提交
- 或按音轨优先级结算

---

### 3.4 回合结算与循环播放

- 所有音轨进入循环播放
- 系统对 4 条音轨分别评分（0–100）
- 得分映射为：
  - 总攻击
  - 总防御

音乐与战斗结算同步呈现。

---

## 4. 结构权限：谁决定“收束”

### 4.1 收束权的定义

> **收束权 = 是否允许本回合触发最终结构结算**

只有在满足以下条件时，才可进入收束判断：
- 达到最小回合数
- 至少一条进攻轨与一条防御轨可用

---

### 4.2 收束权的分配方式（可选）

#### 方式 A：固定指挥
- 房主 / 队长拥有收束权

#### 方式 B：动态继承（推荐）
- 当前管理最多音轨的玩家
- 自动成为“结构负责人”

#### 方式 C：能力争夺
- 某些能力可：
  - 抢夺
  - 借用
  - 否决

---

## 5. 高手如何“为整首曲子拉分”

### 5.1 高手的核心职责

高手的优势不在于把某一轨做到满分，而在于：

1. 判断是否值得收束
2. 承担失败的风险
3. 用能力集中处理坏结果
4. 在高光回合完成结构结算

---

### 5.2 高光能力示例（联机专属）

- 【高光接管】
  - 收束回合中，你可以替代另一名玩家的失败判定

- 【结构兜底】
  - 若任一音轨低于阈值，你承受惩罚，但允许继续收束

- 【延迟终止】
  - 满足收束条件时，可选择推迟 1 回合

---

## 6. 联机模式的体验结果

- 新手体验：
  - “我只要把自己那条轨选稳就好”

- 高手体验：
  - “我在控制整首曲子的命运”

- 团队体验：
  - 像真正的乐团，有指挥、有主奏、有配合

---

## 7. 联机模式最小 Demo 实现清单

- 4 条固定音轨
- 2 / 3 / 4 人音轨分配
- 3 种怪物行动模式
- 基础收束权逻辑
- 5–8 张联机专属能力

---

## 8. 设计总结

> **联机模式的本质不是多人操作，
> 而是多人共同完成一次“正确的结束”。**

> **高手不是更快按对按钮的人，
> 而是知道什么时候，
> 应该让整首音乐结束的人。**

（完）


# 🎼 Rhythm Roguelike 联机合作模式设计（V3）
## —— 基于 V3 系统的多人协作战斗流程

> 本文档基于 V3 战斗系统、卡牌系统、流派系统重新设计联机合作模式，  
> 核心机制：**音轨分工 + 卡池协调 + 干扰体协作消除 + 结构共识**

---

## 一、设计总览

### 1.1 核心设计理念

> **联机不是让每个人玩完整系统，  
> 而是让多个演奏实例共同完成一次清晰、可收束的表达。**

**世界观对应**：
- 多个演奏实例（Performer Instance）协作
- 共同完成结构验证
- 达成结构共识，而非对抗

**系统对应**：
- 音轨分工：每个玩家负责不同的音轨
- 卡池协调：共享或独立卡池，协调流派方向
- 干扰体协作消除：多人协作识别和修复
- 结构共识：共同决定何时收束

### 1.2 支持人数

- **2 人模式**：双人制作人
- **3 人模式**：半指挥制
- **4 人模式**：标准乐团（推荐）

---

## 二、音轨分配系统

### 2.1 音轨定义（基于 V3 战斗系统）

根据 V3 战斗系统，玩家操作的音轨包括：

| 音轨类型 | 可选卡牌类型 | 战斗含义 |
|---------|------------|---------|
| 节奏轨 | 符合基调的节奏牌（自由创作） | 基础节拍结构 |
| 贝斯轨 | 符合基调的贝斯牌（自由创作） | 低音支撑 |
| 主音轨 | 音符组合 + 音阶/调性 + 风格/流派牌 | 主旋律表达 |
| 装饰轨 | 音符组合 + 音阶/调性 + 风格/流派牌 | 装饰性表达 |

**注意**：根据 V3 系统，节奏轨和贝斯轨不受风格流派限制，主音轨和装饰轨决定流派方向。

### 2.2 不同人数下的音轨分配

#### 4 人模式（标准乐团，推荐）

**分配方式**：
- 每名玩家管理 **1 条音轨**
- 责任最清晰，最适合公开匹配

| 玩家 | 音轨 | 职责 | 流派影响 |
|------|------|------|---------|
| P1 | 节奏轨 | 基础节拍结构 | 无流派限制 |
| P2 | 贝斯轨 | 低音支撑 | 无流派限制 |
| P3 | 主音轨 | 主旋律表达 | **决定流派方向** |
| P4 | 装饰轨 | 装饰性表达 | **影响流派方向** |

**优势**：
- 责任清晰，新手友好
- 流派方向由主音轨和装饰轨玩家决定
- 节奏轨和贝斯轨玩家可以专注于基础结构

---

#### 3 人模式（半指挥制）

**分配方式**：
- 1 名高手玩家管理 **2 条音轨**（通常为主音轨 + 装饰轨）
- 其余玩家各管 1 条

**示例分配 A**（高手负责流派）：

| 玩家 | 音轨 | 职责 | 流派影响 |
|------|------|------|---------|
| P1（高手） | 主音轨 + 装饰轨 | 主旋律 + 装饰表达 | **决定流派方向** |
| P2 | 节奏轨 | 基础节拍结构 | 无流派限制 |
| P3 | 贝斯轨 | 低音支撑 | 无流派限制 |

**示例分配 B**（高手负责基础）：

| 玩家 | 音轨 | 职责 | 流派影响 |
|------|------|------|---------|
| P1（高手） | 节奏轨 + 贝斯轨 | 基础节拍 + 低音支撑 | 无流派限制 |
| P2 | 主音轨 | 主旋律表达 | **决定流派方向** |
| P3 | 装饰轨 | 装饰性表达 | **影响流派方向** |

**优势**：
- 高手可以承担更多责任
- 新手可以专注于单一音轨
- 流派方向由主音轨和装饰轨玩家协调

---

#### 2 人模式（双人制作人）

**分配方式**：
- 每名玩家管理 **2 条音轨**
- 强调协作与结构判断

**示例分配 A**（流派分工）：

| 玩家 | 音轨 | 职责 | 流派影响 |
|------|------|------|---------|
| P1 | 主音轨 + 节奏轨 | 主旋律 + 基础节拍 | **决定流派方向** |
| P2 | 装饰轨 + 贝斯轨 | 装饰表达 + 低音支撑 | **影响流派方向** |

**示例分配 B**（功能分工）：

| 玩家 | 音轨 | 职责 | 流派影响 |
|------|------|------|---------|
| P1 | 节奏轨 + 贝斯轨 | 基础节拍 + 低音支撑 | 无流派限制 |
| P2 | 主音轨 + 装饰轨 | 主旋律 + 装饰表达 | **决定流派方向** |

**优势**：
- 强调协作与沟通
- 流派方向需要双方协调
- 适合固定队伍

---

## 三、卡池系统设计

### 3.1 卡池分配模式

#### 模式 A：独立卡池（推荐）

**设计**：
- 每个玩家拥有独立的卡池
- 每个玩家只能看到自己负责音轨的卡池
- 卡池部分可见（每条音轨展示 1 张，其余 4 张背面）

**优势**：
- 符合单人模式的设计
- 每个玩家专注于自己的音轨
- 流派协调需要沟通

**挑战**：
- 流派方向需要协调
- 需要沟通卡池内容

---

#### 模式 B：共享卡池（可选）

**设计**：
- 所有玩家共享一个卡池
- 每个玩家可以看到所有音轨的卡池
- 但只能操作自己负责的音轨

**优势**：
- 流派方向更容易协调
- 团队可以共同规划构筑

**挑战**：
- 需要重新设计卡池可见性
- 可能降低个人责任感

---

### 3.2 流派协调机制

#### 流派方向决定

**决定方式**：
- 主音轨玩家决定主要流派方向
- 装饰轨玩家影响流派方向
- 节奏轨和贝斯轨玩家不参与流派决定

**协调机制**：
- 玩家可以在安全舱或战斗前沟通流派方向
- 主音轨和装饰轨玩家需要协调风格和流派
- 系统根据主音轨和装饰轨的卡池计算流派纯度

**流派纯度计算**：
- 根据主音轨和装饰轨的卡池计算
- 如果两个玩家选择相同流派，流派纯度更高
- 如果两个玩家选择不同流派，形成混合流派

---

### 3.3 污染卡池设计

**设计**：
- 所有玩家共享一个污染卡池
- 污染卡池对每条音轨有 4~8 张污染卡（与段落数一致）
- 所有玩家都能看到污染卡池的内容

**消除机制**：
- 当任意玩家修复成功时，删除污染卡池中对应音轨的卡牌（每条音轨各一张）
- 所有玩家共享消除进度
- 污染卡池归零时，战斗结束

---

## 四、战斗流程设计

### 4.1 战斗开始

**进入战斗后**：
- 系统提供基调节奏 + 贝斯（所有玩家都能听到）
- 每个玩家看到自己负责音轨的卡池（部分可见）
- 所有玩家看到共享的污染卡池

**流派方向显示**：
- 系统根据主音轨和装饰轨的卡池显示当前流派方向
- 显示流派纯度（纯流派 / 混合流派）
- 所有玩家都能看到流派信息

---

### 4.2 回合流程

#### ① 干扰体刷新

**刷新规则**（基于 V3 系统）：
- 根据**所有玩家的实时卡池**刷新
- 卡池里的牌有哪些风格和流派，就会刷出对应风格和流派的干扰
- 干扰体可以干扰 1 条或多条音轨
- 造成 1 种或多种干扰

**干扰效果**：
- 使玩家的每条音轨随机发生变化
- 偏离本段应该有的：节奏、音阶、调性、风格、流派
- 所有玩家都能看到干扰效果

---

#### ② 玩家选择阶段

**选择流程**：
1. 每个玩家在自己负责的音轨上看到：
   - 1~2 张自己卡池里的牌（可见）
   - 污染卡牌（来自共享污染卡池）
   - **总共 5~6 张卡牌**

2. 每个玩家独立选择：
   - 选择正确的卡牌（污染牌也可以是正确的效果）
   - 修复音轨，使当前段落符合乐理

3. **协作提示**（可选）：
   - 玩家可以选择标记"需要帮助"
   - 其他玩家可以看到标记
   - 高手玩家可以使用能力帮助

---

#### ③ 回合结算

**修复成功**（玩家判断正确）：
- 消灭对应的干扰体
- 删除共享污染卡池里的卡牌（每条音轨各一张）
- 进入下一个段落

**修复失败**：
- 进入下一回合
- 干扰体全部刷新
- 对玩家再次造成来自不同风格和流派的干扰

**强制结束段落**（3 回合后）：
- 如果三个回合以后还没有消灭干扰体
- 强制结束这个段落
- 保留玩家当前的错误选择
- 进入下一个段落

---

### 4.3 段落推进

**进入下一段落时**：
- 干扰体会根据所有玩家的卡池进行刷新
- 所有玩家看到新的干扰效果

**段落结束条件**：
- 所有玩家应对正确则快速结束段落
- 删除共享污染卡池的卡牌（每条音轨各一张）
- 直到污染卡池归零

**挑战失败条件**：
- 如果玩家在完成 8 段之后还没有成功修复
- 挑战失败，结束整局

---

## 五、流派系统设计

### 5.1 纯流派玩法（联机）

#### 定义

**纯流派判定条件**：
- 主音轨和装饰轨玩家的卡池中，≥70% 段落表达来自同一流派倾向
- 卡池中风格和流派高度统一
- 敌人能够造成迷惑的空间越来越小

**优势**：
- 干扰体的干扰能力随着卡池净化而减少
- 所有玩家能更快做出正确选择结束段落
- 污染卡池越来越小
- 达成通过构筑流派快速结束战斗的效果

**协调要求**：
- 主音轨和装饰轨玩家需要协调流派方向
- 两个玩家选择相同流派，流派纯度更高
- 需要沟通和配合

---

### 5.2 混合流派玩法（联机）

#### 定义

**混合流派判定条件**：
- 主音轨和装饰轨玩家的卡池中，无任何流派占比 ≥60%
- 卡池中包含多种风格和流派
- 风格流派纯度较低
- 敌人能够造成迷惑的空间较大

**特点**：
- 可能需要更多段落来呈现混合流派的优点
- 干扰体可以刷出多种风格和流派的干扰
- 玩家需要识别和排除多种干扰

**协调要求**：
- 主音轨和装饰轨玩家可以选择不同流派
- 形成混合流派，需要更多沟通
- 高手可以利用污染卡牌获得想要的效果

---

### 5.3 流派协调机制

#### 流派方向显示

**显示内容**：
- 当前流派方向（根据主音轨和装饰轨的卡池计算）
- 流派纯度（纯流派 / 混合流派）
- 各流派占比

**显示位置**：
- 所有玩家都能看到流派信息
- 在战斗界面顶部显示
- 实时更新

---

#### 流派协调工具

**沟通工具**：
- 玩家可以在战斗中使用快捷消息
- 标记"需要帮助"或"流派方向"
- 高手玩家可以使用能力帮助

**协调奖励**：
- 如果主音轨和装饰轨玩家选择相同流派，流派纯度更高
- 流派纯度越高，干扰体的干扰能力越弱
- 形成纯流派，战斗节奏更快

---

## 六、结构权限系统

### 6.1 结构共识的定义

> **结构共识 = 多个演奏实例共同决定何时完成结构验证**

**世界观对应**：
- 多个演奏实例达成结构共识
- 共同完成结构验证
- 知道什么时候可以结束

---

### 6.2 收束权分配

#### 方式 A：固定指挥（推荐）

**设计**：
- 房主 / 队长拥有收束权
- 只有房主可以决定是否收束

**优势**：
- 责任清晰
- 适合固定队伍

---

#### 方式 B：动态继承

**设计**：
- 当前管理最多音轨的玩家拥有收束权
- 自动成为"结构负责人"

**优势**：
- 高手自动承担更多责任
- 适合公开匹配

---

#### 方式 C：投票机制

**设计**：
- 所有玩家投票决定是否收束
- 需要多数同意才能收束

**优势**：
- 民主决策
- 适合固定队伍

---

### 6.3 收束条件

**收束条件**：
- 达到最小段落数（通常为 4 段）
- 至少一条主音轨与一条装饰轨可用
- 污染卡池接近归零
- 流派方向明确

**收束判断**：
- 拥有收束权的玩家可以决定是否收束
- 系统显示当前是否满足收束条件
- 所有玩家都能看到收束状态

---

## 七、协作机制设计

### 7.1 高手帮助机制

#### 能力介入

**设计**：
- 高手玩家可以使用能力帮助其他玩家
- 防止表达被淹没（根据统一设计：失败 = 表达被淹没）
- 转移得分
- 覆盖固定规则
- 标记"准备收束"

**能力类型**：
- **高光接管**：收束回合中，可以替代另一名玩家的表达不清晰判定
- **结构兜底**：若任一音轨低于阈值，承受惩罚，但允许继续收束
- **延迟终止**：满足收束条件时，可选择推迟 1 回合（等待更好的表达时机）

---

#### 协作提示

**设计**：
- 玩家可以选择标记"需要帮助"
- 其他玩家可以看到标记
- 高手玩家可以使用能力帮助

**提示类型**：
- "需要帮助"：玩家不确定如何选择
- "流派方向"：玩家想协调流派方向
- "准备收束"：玩家认为可以收束

---

### 7.2 新手保护机制

#### 容错设计

**设计**：
- 新手玩家可以标记"需要帮助"
- 高手玩家可以使用能力帮助
- 新手玩家的错误不会立即导致失败

**保护机制**：
- 新手玩家的错误选择不会立即导致段落失败
- 高手玩家可以使用能力帮助修复
- 系统提供更多提示和引导

---

#### 学习机制

**设计**：
- 新手玩家可以看到其他玩家的选择
- 系统提供选择理由的提示
- 高手玩家可以使用能力帮助解释

**学习内容**：
- 如何识别污染卡牌
- 如何判断流派方向
- 如何选择正确的卡牌

---

## 八、战斗后奖励

### 8.1 奖励分配

**敌人掉落**：
- **破损芯片**（局内货币）：所有玩家共享
- **卡牌奖励**：每个玩家独立获得
  - 由玩家 3 选 1 或 5 选 2（根据玩家操作的音轨数量）
  - 用于卡池构筑

**协作奖励**：
- 如果所有玩家都成功修复，获得额外奖励
- 如果形成纯流派，获得流派协同奖励
- 如果快速完成战斗（4-6 段），获得效率奖励

---

### 8.2 卡池构筑

**构筑过程**：
- 每个玩家独立构筑自己的卡池
- 主音轨和装饰轨玩家需要协调流派方向
- 通过战斗后奖励选择卡牌
- 通过暗网商人删除不需要的卡牌

**流派协调**：
- 主音轨和装饰轨玩家可以在安全舱沟通流派方向
- 选择相同流派，流派纯度更高
- 选择不同流派，形成混合流派

---

## 九、特殊机制设计

### 9.1 Boss 战设计

**污染增强**：
- 直接污染所有玩家的卡池（每条音轨增加 1/3 的污染牌）
- 考验玩家是否真的理解自己正在构筑的流派
- 需要所有玩家协作识别污染卡牌

**战斗状态**：
- 玩家一般都已经有了成熟的流派和足够的道具
- 需要在污染增强的情况下识别哪些是自己的牌，哪些是污染牌
- 即使没抽到想要的牌，打不出想要的效果，也要通过增加段落来完成战斗

**协作要求**：
- 所有玩家需要协作识别污染卡牌
- 高手玩家可以使用能力帮助
- 需要共同决定流派方向

---

### 9.2 赛博核心区域（20+层）

**设计**：
- 默认假设多人参与
- 强调沟通与协作
- 奖励偏向外观、UI、演出表现

**特殊机制**：
- 需要所有玩家协作完成结构验证
- 干扰体刷新更频繁
- 污染卡池更大
- 需要更高的流派协调

**世界观对应**：
- 赛博核心区域是：**熟悉系统规则的玩家之间，进行长期合作的场所。**
- 这里不是考验技巧，而是考验多个实例是否能达成结构共识。

---

## 十、体验目标

### 10.1 新手体验

**目标**：
- "我只要把自己那条轨选稳就好"
- 不会因失误毁掉整首曲子
- 可以看到其他玩家的选择，学习如何选择

**保护机制**：
- 新手玩家可以标记"需要帮助"
- 高手玩家可以使用能力帮助
- 系统提供更多提示和引导

---

### 10.2 高手体验

**目标**：
- "我在控制整首曲子的命运"
- 通过承担更多音轨或结构权限
- 决定是否进入高光收束
- 帮助其他玩家完成结构验证

**表达空间**：
- 可以使用能力帮助其他玩家
- 可以决定是否收束
- 可以协调流派方向

---

### 10.3 团队体验

**目标**：
- 像真正的乐团，有指挥、有主奏、有配合
- 多个演奏实例共同完成一次清晰、可收束的表达
- 达成结构共识，而非对抗

**协作机制**：
- 音轨分工：每个玩家负责不同的音轨
- 流派协调：主音轨和装饰轨玩家协调流派方向
- 结构共识：共同决定何时收束

---

## 十一、设计总结

### 11.1 核心机制

1. **音轨分工**：每个玩家负责不同的音轨
2. **卡池协调**：独立或共享卡池，协调流派方向
3. **干扰体协作消除**：多人协作识别和修复
4. **结构共识**：共同决定何时收束

### 11.2 设计理念

> **联机模式的本质不是多人操作，  
> 而是多人共同完成一次"正确的结束"。**

> **高手不是更快按对按钮的人，  
> 而是知道什么时候，  
> 应该让整首音乐结束的人。**

### 11.3 世界观对应

> **多个演奏实例（Performer Instance）协作，  
> 共同完成结构验证，  
> 达成结构共识，而非对抗。**

---

## 十二、实现清单

### 12.1 核心功能

- [ ] 音轨分配系统（2/3/4 人）
- [ ] 卡池系统（独立/共享）
- [ ] 流派协调机制
- [ ] 干扰体协作消除
- [ ] 结构权限系统
- [ ] 协作机制（高手帮助、新手保护）
- [ ] 战斗后奖励分配

### 12.2 特殊机制

- [ ] Boss 战设计
- [ ] 赛博核心区域（20+层）
- [ ] 流派协调工具
- [ ] 协作提示系统

### 12.3 UI/UX

- [ ] 流派方向显示
- [ ] 协作提示界面
- [ ] 收束状态显示
- [ ] 玩家状态显示

---

（完）
